<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üîç Debug Balance Loading</title>
    <style>
        body {
            background: #0a0a0a;
            color: #00d9ff;
            font-family: 'Courier New', monospace;
            padding: 20px;
            line-height: 1.6;
        }
        .log {
            background: #1a1a1a;
            border: 1px solid #00d9ff;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .success { color: #00ff00; }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        h1 { color: #ffd700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.6); }
        h2 { color: #00d9ff; }
        code { background: #2a2a2a; padding: 2px 6px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–ª–∞–Ω—Å–∞</h1>
    
    <div class="log">
        <h2>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</h2>
        <p><strong>–ü–æ–ª–Ω—ã–π URL:</strong> <code id="fullUrl"></code></p>
        <p><strong>Search –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:</strong> <code id="searchParams"></code></p>
        <p><strong>Hash:</strong> <code id="hashPart"></code></p>
    </div>

    <div class="log">
        <h2>üí∞ –ü–æ–ø—ã—Ç–∫–∞ –∏–∑–≤–ª–µ—á—å –±–∞–ª–∞–Ω—Å:</h2>
        <p id="balanceResult"></p>
    </div>

    <div class="log">
        <h2>üìù –ü–æ–¥—Ä–æ–±–Ω—ã–π –ª–æ–≥:</h2>
        <pre id="detailedLog"></pre>
    </div>

    <div class="log">
        <h2>üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:</h2>
        <h1 id="finalBalance" style="text-align: center;">?</h1>
    </div>

    <script>
        let logs = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            const logMessage = `[${timestamp}] ${prefix} ${message}`;
            logs.push(logMessage);
            console.log(logMessage);
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('detailedLog').textContent = logs.join('\n');
        }

        // –ê–Ω–∞–ª–∏–∑ URL
        log('=== –ù–ê–ß–ê–õ–û –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò ===');
        
        const fullUrl = window.location.href;
        document.getElementById('fullUrl').textContent = fullUrl;
        log(`URL: ${fullUrl}`);

        const searchParams = window.location.search;
        document.getElementById('searchParams').textContent = searchParams || '(–ø—É—Å—Ç–æ)';
        log(`Search: ${searchParams}`);

        const hashPart = window.location.hash;
        document.getElementById('hashPart').textContent = hashPart || '(–ø—É—Å—Ç–æ)';
        log(`Hash: ${hashPart}`);

        // –ü–æ–ø—ã—Ç–∫–∞ –∏–∑–≤–ª–µ—á—å –±–∞–ª–∞–Ω—Å
        log('--- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ balance ---');
        
        try {
            const urlParams = new URLSearchParams(window.location.search);
            log(`URLSearchParams —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ`);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            log('–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ URL:');
            for (const [key, value] of urlParams.entries()) {
                log(`  - ${key} = ${value}`, 'info');
            }
            
            const balanceParam = urlParams.get('balance');
            log(`urlParams.get('balance') –≤–µ—Ä–Ω—É–ª: ${balanceParam}`);
            
            if (balanceParam !== null && balanceParam !== undefined) {
                log(`–ü–∞—Ä–∞–º–µ—Ç—Ä balance –Ω–∞–π–¥–µ–Ω: "${balanceParam}"`, 'success');
                
                const parsed = parseInt(balanceParam);
                log(`parseInt("${balanceParam}") = ${parsed}`);
                
                if (!isNaN(parsed) && parsed >= 0) {
                    log(`‚úÖ –£–°–ü–ï–•! –ë–∞–ª–∞–Ω—Å: ${parsed} ‚≠ê`, 'success');
                    document.getElementById('balanceResult').innerHTML = 
                        `<span class="success">‚úÖ –ë–∞–ª–∞–Ω—Å —É—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ—á—ë–Ω: ${parsed} ‚≠ê</span>`;
                    document.getElementById('finalBalance').textContent = `${parsed} ‚≠ê`;
                    document.getElementById('finalBalance').className = 'success';
                } else {
                    log(`‚ùå –û–®–ò–ë–ö–ê: parseInt –≤–µ—Ä–Ω—É–ª NaN –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ`, 'error');
                    document.getElementById('balanceResult').innerHTML = 
                        `<span class="error">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å: "${balanceParam}"</span>`;
                    document.getElementById('finalBalance').textContent = '–û–®–ò–ë–ö–ê –ü–ê–†–°–ò–ù–ì–ê';
                    document.getElementById('finalBalance').className = 'error';
                }
            } else {
                log(`‚ùå –û–®–ò–ë–ö–ê: –ü–∞—Ä–∞–º–µ—Ç—Ä balance –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ URL`, 'error');
                document.getElementById('balanceResult').innerHTML = 
                    `<span class="error">‚ùå –ü–∞—Ä–∞–º–µ—Ç—Ä 'balance' –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ URL</span>`;
                document.getElementById('finalBalance').textContent = '–ù–ï–¢ –ü–ê–†–ê–ú–ï–¢–†–ê';
                document.getElementById('finalBalance').className = 'error';
            }
            
        } catch (error) {
            log(`‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: ${error.message}`, 'error');
            log(`Stack trace: ${error.stack}`, 'error');
            document.getElementById('balanceResult').innerHTML = 
                `<span class="error">‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: ${error.message}</span>`;
            document.getElementById('finalBalance').textContent = 'EXCEPTION';
            document.getElementById('finalBalance').className = 'error';
        }
        
        log('=== –ö–û–ù–ï–¶ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò ===');
        
        // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º Telegram Web App API
        log('--- –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram WebApp API ---');
        if (window.Telegram && window.Telegram.WebApp) {
            log('‚úÖ Telegram WebApp API –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
            const tg = window.Telegram.WebApp;
            log(`initData: ${tg.initData || '(–ø—É—Å—Ç–æ)'}`);
            log(`initDataUnsafe: ${JSON.stringify(tg.initDataUnsafe)}`);
        } else {
            log('‚ö†Ô∏è Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ –≤ Telegram)', 'warning');
        }
    </script>
</body>
</html>
