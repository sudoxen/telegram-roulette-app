#!/usr/bin/env python3
"""
üéÆ –°–ò–ú–£–õ–Ø–¶–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø - –ü–û–õ–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï
–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞ –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
"""

import asyncio
from database import db

async def simulate_user_testing():
    """–°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("üéÆ –°–ò–ú–£–õ–Ø–¶–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø - –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ö–ê–ó–ò–ù–û-–ë–û–¢–ê")
    print("=" * 60)
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    await db.init_db()
    print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞")
    
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_id = 999888777
    username = "test_player"
    first_name = "–¢–µ—Å—Ç–æ–≤—ã–π –ò–≥—Ä–æ–∫"
    
    print(f"\nüë§ –ù–û–í–´–ô –ò–ì–†–û–ö –ü–†–ò–°–û–ï–î–ò–ù–Ø–ï–¢–°–Ø")
    print("-" * 40)
    print(f"üÜî ID: {user_id}")
    print(f"üë§ –ò–º—è: {first_name}")
    print(f"üìù Username: @{username}")
    
    # –¢–µ—Å—Ç 1: /start - –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
    print(f"\nüöÄ –¢–ï–°–¢ 1: –ö–û–ú–ê–ù–î–ê /start")
    print("-" * 40)
    user = await db.get_or_create_user(user_id, username, first_name)
    print(f"üí∞ –°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: {user['balance']} ‚≠ê")
    print("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö")
    print("‚úÖ –ö–Ω–æ–ø–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è: [üé∞ –ò–≥—Ä–∞—Ç—å] [üí∞ –ë–∞–ª–∞–Ω—Å] [üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞]")
    
    # –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
    print(f"\nüí∞ –¢–ï–°–¢ 2: –ü–†–û–í–ï–†–ö–ê –ë–ê–õ–ê–ù–°–ê")
    print("-" * 40)
    balance = await db.get_balance(user_id)
    print(f"üí∞ –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: {balance} ‚≠ê")
    if balance >= 200:
        print("‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –∏–≥—Ä—ã")
    else:
        print("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤")
    
    # –¢–µ—Å—Ç 3: –ü–µ—Ä–≤–∞—è –∏–≥—Ä–∞
    print(f"\nüé≤ –¢–ï–°–¢ 3: –ü–ï–†–í–ê–Ø –ò–ì–†–ê")
    print("-" * 40)
    print("üéØ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç '–ò–≥—Ä–∞—Ç—å –≤ —Ä—É–ª–µ—Ç–∫—É'")
    
    # –°–∏–º—É–ª–∏—Ä—É–µ–º URL Web App
    webapp_url = f"https://sudoxen.github.io/telegram-roulette-app/?balance={balance}&user_id={user_id}&v=123456"
    print(f"üåê Web App URL: {webapp_url}")
    print("‚úÖ Web App –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º")
    
    # –°–∏–º—É–ª–∏—Ä—É–µ–º –∏–≥—Ä—É
    import random
    multipliers = [1, 1, 1, 1, 1, 1, 1, 1, 1, 10]  # 10% —à–∞–Ω—Å –¥–∂–µ–∫–ø–æ—Ç–∞
    result = random.choice(multipliers)
    bet = 200
    win = bet * result
    new_balance = balance - bet + win
    
    print(f"üé≤ –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã:")
    print(f"   üí∞ –°—Ç–∞–≤–∫–∞: {bet} ‚≠ê")
    print(f"   üéØ –ú–Ω–æ–∂–∏—Ç–µ–ª—å: {result}X")
    print(f"   üèÜ –í—ã–∏–≥—Ä—ã—à: {win} ‚≠ê")
    print(f"   üí≥ –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: {new_balance} ‚≠ê")
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –≤ –ë–î
    await db.update_balance(user_id, new_balance)
    await db.record_bet(user_id, bet, win)
    
    if result == 10:
        print("üéâ –î–ñ–ï–ö–ü–û–¢! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ")
    else:
        print("‚úÖ –û–±—ã—á–Ω–∞—è –∏–≥—Ä–∞, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∫–∞–∑–∞–Ω")
    
    # –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    print(f"\nüìä –¢–ï–°–¢ 4: –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û–°–õ–ï –ò–ì–†–´")
    print("-" * 40)
    stats = await db.get_user_stats(user_id)
    print(f"üí∞ –ë–∞–ª–∞–Ω—Å: {stats['balance']} ‚≠ê")
    print(f"üéØ –û–±—â–∏—Ö —Å—Ç–∞–≤–æ–∫: {stats['total_bets']} ‚≠ê")
    print(f"üèÜ –û–±—â–∏—Ö –≤—ã–∏–≥—Ä—ã—à–µ–π: {stats['total_wins']} ‚≠ê")
    print(f"üìà –ü—Ä–∏–±—ã–ª—å: {stats['profit']:+d} ‚≠ê")
    print("‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å")
    
    # –¢–µ—Å—Ç 5: –ù–µ—Å–∫–æ–ª—å–∫–æ –∏–≥—Ä –ø–æ–¥—Ä—è–¥
    print(f"\nüéÆ –¢–ï–°–¢ 5: –ò–ì–†–û–í–ê–Ø –°–ï–°–°–ò–Ø (5 –ò–ì–†)")
    print("-" * 40)
    
    for game_num in range(1, 6):
        current_balance = await db.get_balance(user_id)
        
        if current_balance < 200:
            print(f"‚ùå –ò–≥—Ä–∞ {game_num}: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ ({current_balance} ‚≠ê)")
            break
        
        result = random.choice(multipliers)
        bet = 200
        win = bet * result
        new_balance = current_balance - bet + win
        
        await db.update_balance(user_id, new_balance)
        await db.record_bet(user_id, bet, win)
        
        status = "üéâ –î–ñ–ï–ö–ü–û–¢!" if result == 10 else "üéØ –û–±—ã—á–Ω–∞—è –∏–≥—Ä–∞"
        print(f"üé≤ –ò–≥—Ä–∞ {game_num}: {result}X ‚Üí {win} ‚≠ê | –ë–∞–ª–∞–Ω—Å: {new_balance} ‚≠ê | {status}")
    
    # –¢–µ—Å—Ç 6: –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    print(f"\nüìà –¢–ï–°–¢ 6: –§–ò–ù–ê–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê")
    print("-" * 40)
    final_stats = await db.get_user_stats(user_id)
    print(f"üí∞ –§–∏–Ω–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: {final_stats['balance']} ‚≠ê")
    print(f"üéØ –í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫: {final_stats['total_bets']} ‚≠ê")
    print(f"üèÜ –í—Å–µ–≥–æ –≤—ã–∏–≥—Ä—ã—à–µ–π: {final_stats['total_wins']} ‚≠ê")
    print(f"üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä: {final_stats['total_bets'] // 200}")
    print(f"üìà –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–∏–±—ã–ª—å: {final_stats['profit']:+d} ‚≠ê")
    
    if final_stats['profit'] > 0:
        print("‚úÖ –ò–≥—Ä–æ–∫ –≤ –ø–ª—é—Å–µ!")
    else:
        print("üìâ –ò–≥—Ä–æ–∫ –≤ –º–∏–Ω—É—Å–µ")
    
    # –¢–µ—Å—Ç 7: –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤
    print(f"\nüèÜ –¢–ï–°–¢ 7: –†–ï–ô–¢–ò–ù–ì –ò–ì–†–û–ö–û–í")
    print("-" * 40)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –µ—â–µ –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∞
    test_players = [
        (111111111, "winner_alice", "–ê–ª–∏—Å–∞ –í–µ–∑—É–Ω—á–∏–∫", 5000),
        (222222222, "lucky_bob", "–ë–æ–± –£–¥–∞—á–Ω–∏–∫", 3500),
        (333333333, "pro_charlie", "–ß–∞—Ä–ª–∏ –ü—Ä–æ—Ñ–∏", 2800)
    ]
    
    for pid, pusername, pname, pbalance in test_players:
        await db.get_or_create_user(pid, pusername, pname)
        await db.update_balance(pid, pbalance)
        await db.record_bet(pid, 1000, 2000)  # –°–∏–º—É–ª–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é
    
    top_users = await db.get_top_users(5)
    print("üèÜ –¢–æ–ø-5 –∏–≥—Ä–æ–∫–æ–≤:")
    for i, player in enumerate(top_users, 1):
        emoji = ["ü•á", "ü•à", "ü•â", "4Ô∏è‚É£", "5Ô∏è‚É£"][i-1]
        profit = player['total_wins'] - player['total_bets']
        print(f"   {emoji} {player['first_name']}: {player['balance']} ‚≠ê (–ø—Ä–∏–±—ã–ª—å: {profit:+d})")
    
    # –¢–µ—Å—Ç 8: –°–±—Ä–æ—Å –±–∞–ª–∞–Ω—Å–∞
    print(f"\nüîÑ –¢–ï–°–¢ 8: –°–ë–†–û–° –ë–ê–õ–ê–ù–°–ê")
    print("-" * 40)
    print("üéÆ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ")
    
    old_balance = await db.get_balance(user_id)
    print(f"üí∞ –ë–∞–ª–∞–Ω—Å –¥–æ —Å–±—Ä–æ—Å–∞: {old_balance} ‚≠ê")
    
    await db.reset_user_balance(user_id, 1000)
    new_balance = await db.get_balance(user_id)
    print(f"üí∞ –ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞: {new_balance} ‚≠ê")
    print("‚úÖ –°–±—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω")
    
    # –¢–µ—Å—Ç 9: –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ Web App
    print(f"\nüì± –¢–ï–°–¢ 9: –ü–û–í–¢–û–†–ù–û–ï –û–¢–ö–†–´–¢–ò–ï WEB APP")
    print("-" * 40)
    print("üîÑ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä—ã–ª –∏ —Å–Ω–æ–≤–∞ –æ—Ç–∫—Ä—ã–ª –∏–≥—Ä—É")
    
    current_balance = await db.get_balance(user_id)
    new_webapp_url = f"https://sudoxen.github.io/telegram-roulette-app/?balance={current_balance}&user_id={user_id}&v=789012"
    print(f"üåê –ù–æ–≤—ã–π URL: {new_webapp_url}")
    print(f"üí∞ –ë–∞–ª–∞–Ω—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: {current_balance} ‚≠ê")
    print("‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!")
    
    # –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
    print(f"\n" + "=" * 60)
    print("üìã –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø")
    print("=" * 60)
    
    tests = [
        ("‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞", "–†–∞–±–æ—Ç–∞–µ—Ç"),
        ("‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞", "–†–∞–±–æ—Ç–∞–µ—Ç"),
        ("‚úÖ Web App —Å –±–∞–ª–∞–Ω—Å–æ–º", "–†–∞–±–æ—Ç–∞–µ—Ç"),
        ("‚úÖ –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞", "–†–∞–±–æ—Ç–∞–µ—Ç"),
        ("‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤", "–†–∞–±–æ—Ç–∞–µ—Ç"),
        ("‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞", "–†–∞–±–æ—Ç–∞–µ—Ç"),
        ("‚úÖ –ò–≥—Ä–æ–≤–∞—è —Å–µ—Å—Å–∏—è", "–†–∞–±–æ—Ç–∞–µ—Ç"),
        ("‚úÖ –†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤", "–†–∞–±–æ—Ç–∞–µ—Ç"),
        ("‚úÖ –°–±—Ä–æ—Å –±–∞–ª–∞–Ω—Å–∞", "–†–∞–±–æ—Ç–∞–µ—Ç"),
        ("‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö", "–†–∞–±–æ—Ç–∞–µ—Ç")
    ]
    
    for test_name, status in tests:
        print(f"{test_name:<35} | {status}")
    
    print(f"\nüéØ –†–ï–ó–£–õ–¨–¢–ê–¢: –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!")
    print(f"üé∞ –ö–∞–∑–∏–Ω–æ-–±–æ—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏!")
    
    # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    print(f"\nüí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ:")
    print("-" * 40)
    print("1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π")
    print("2. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    print("3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤")
    print("4. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∞–º–∏")
    print("5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö URL –¥–ª—è –æ–±—Ö–æ–¥–∞ –∫—ç—à–∞")
    print("6. ‚úÖ –£–ª—É—á—à–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Web App")
    print("7. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞")

if __name__ == "__main__":
    asyncio.run(simulate_user_testing())