# База данных для Телеграм-бота казино

## Описание

Бот использует SQLite базу данных для хранения информации о пользователях и их балансах. База данных создается автоматически при первом запуске бота.

## Структура базы данных

### Таблица `users`

| Поле | Тип | Описание |
|------|-----|----------|
| `user_id` | INTEGER PRIMARY KEY | ID пользователя в Telegram |
| `username` | TEXT | Username пользователя (@username) |
| `first_name` | TEXT | Имя пользователя |
| `balance` | INTEGER | Текущий баланс в звездах (по умолчанию 1000) |
| `total_bets` | INTEGER | Общая сумма всех ставок |
| `total_wins` | INTEGER | Общая сумма всех выигрышей |
| `created_at` | TIMESTAMP | Дата создания записи |
| `updated_at` | TIMESTAMP | Дата последнего обновления |

## Функции базы данных

### UserDatabase класс (`database.py`)

#### Основные методы:

- `init_db()` - Инициализация базы данных и создание таблиц
- `get_user(user_id)` - Получить информацию о пользователе
- `create_user(user_id, username, first_name)` - Создать нового пользователя
- `get_or_create_user(user_id, username, first_name)` - Получить или создать пользователя
- `get_balance(user_id)` - Получить баланс пользователя
- `update_balance(user_id, new_balance)` - Обновить баланс
- `add_balance(user_id, amount)` - Добавить/отнять к балансу
- `record_bet(user_id, bet_amount, win_amount)` - Записать информацию о ставке
- `get_user_stats(user_id)` - Получить статистику пользователя
- `get_top_users(limit)` - Получить топ пользователей по балансу
- `reset_user_balance(user_id, new_balance)` - Сбросить баланс

## Новые команды бота

- `/start` - Приветствие и создание пользователя в БД
- `/balance` - Показать текущий баланс
- `/stats` - Показать полную статистику игрока
- `/top` - Показать топ-10 игроков по балансу
- `/reset` - Сбросить баланс до 1000 звезд
- `/help` - Справка по всем командам

## Файлы

- `database.py` - Класс для работы с базой данных
- `telegram_bot.py` - Основной файл бота (обновлен)
- `users.db` - Файл базы данных SQLite (создается автоматически)
- `requirements.txt` - Зависимости (добавлен aiosqlite)

## Установка и запуск

1. Установить зависимости:
```bash
pip install -r requirements.txt
```

2. Заменить `BOT_TOKEN` в `telegram_bot.py` на токен от @BotFather

3. Запустить бота:
```bash
python telegram_bot.py
```

База данных `users.db` будет создана автоматически при первом запуске.

## Особенности

- Все операции с базой данных асинхронные
- Автоматическое создание пользователей при первом использовании
- Баланс не может быть отрицательным
- Ведется полная статистика ставок и выигрышей
- Безопасные транзакции с базой данных
- Данные сохраняются между перезапусками бота