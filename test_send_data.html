<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: #fff;
            padding: 20px;
        }
        button {
            background: #ffd700;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            display: block;
            width: 90%;
        }
        .log {
            background: #1a1a1a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 12px;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É</h1>
    
    <div id="info" class="log"></div>
    
    <button onclick="testSendData()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
    <button onclick="testWithMainButton()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ MainButton</button>
    <button onclick="testClose()">üö™ –ó–∞–∫—Ä—ã—Ç—å Web App</button>
    
    <div id="logs" class="log"></div>
    
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        let logText = '';
        
        function log(message) {
            console.log(message);
            logText += message + '\n';
            document.getElementById('logs').textContent = logText;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Web App
        document.getElementById('info').innerHTML = `
            <b>üì± Telegram Web App Info:</b><br>
            ‚Ä¢ initData: ${tg.initData ? '–ï—Å—Ç—å ‚úÖ' : '–ù–ï–¢ ‚ùå'}<br>
            ‚Ä¢ User ID: ${tg.initDataUnsafe?.user?.id || '–ù–ï–¢'}<br>
            ‚Ä¢ Username: @${tg.initDataUnsafe?.user?.username || '–ù–ï–¢'}<br>
            ‚Ä¢ sendData –¥–æ—Å—Ç—É–ø–µ–Ω: ${typeof tg.sendData === 'function' ? '–î–ê ‚úÖ' : '–ù–ï–¢ ‚ùå'}<br>
            ‚Ä¢ MainButton –¥–æ—Å—Ç—É–ø–µ–Ω: ${tg.MainButton ? '–î–ê ‚úÖ' : '–ù–ï–¢ ‚ùå'}<br>
            ‚Ä¢ close –¥–æ—Å—Ç—É–ø–µ–Ω: ${typeof tg.close === 'function' ? '–î–ê ‚úÖ' : '–ù–ï–¢ ‚ùå'}
        `;
        
        function testSendData() {
            log('=== –¢–ï–°–¢ 1: tg.sendData() ===');
            
            const testData = {
                action: 'test',
                message: '–ü—Ä–∏–≤–µ—Ç –æ—Ç Web App!',
                timestamp: new Date().toISOString()
            };
            
            try {
                if (tg && typeof tg.sendData === 'function') {
                    const dataString = JSON.stringify(testData);
                    log('–î–∞–Ω–Ω—ã–µ: ' + dataString);
                    
                    tg.sendData(dataString);
                    log('‚úÖ sendData() –≤—ã–∑–≤–∞–Ω');
                    
                    log('‚è± –ó–∞–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã...');
                    setTimeout(() => {
                        log('üö™ –ó–∞–∫—Ä—ã–≤–∞–µ–º Web App...');
                        tg.close();
                    }, 2000);
                } else {
                    log('‚ùå sendData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!');
                }
            } catch (error) {
                log('‚ùå –û–®–ò–ë–ö–ê: ' + error.message);
            }
        }
        
        function testWithMainButton() {
            log('=== –¢–ï–°–¢ 2: MainButton ===');
            
            const testData = {
                action: 'test_mainbutton',
                message: '–û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ MainButton',
                timestamp: new Date().toISOString()
            };
            
            try {
                if (tg.MainButton) {
                    const dataString = JSON.stringify(testData);
                    log('–î–∞–Ω–Ω—ã–µ: ' + dataString);
                    
                    tg.sendData(dataString);
                    log('‚úÖ sendData() –≤—ã–∑–≤–∞–Ω');
                    
                    tg.MainButton.setText('‚úÖ –ì–æ—Ç–æ–≤–æ - –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è');
                    tg.MainButton.show();
                    tg.MainButton.onClick(() => {
                        log('MainButton –Ω–∞–∂–∞—Ç–∞');
                        tg.close();
                    });
                } else {
                    log('‚ùå MainButton –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!');
                }
            } catch (error) {
                log('‚ùå –û–®–ò–ë–ö–ê: ' + error.message);
            }
        }
        
        function testClose() {
            log('üö™ –ó–∞–∫—Ä—ã–≤–∞–µ–º Web App...');
            try {
                tg.close();
            } catch (error) {
                log('‚ùå –û–®–ò–ë–ö–ê: ' + error.message);
            }
        }
    </script>
</body>
</html>
